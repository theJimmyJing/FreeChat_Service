### 1. OpenIM系统组件介绍
OpenIM系统依赖六大组件，在编译部署OpenIM之前需要保证其安装好(以下为官方使用的组件版本)
```
1、ETCD（version:{"etcdserver":"3.3.8","etcdcluster":"3.3.0"}）//服务注册与发现
2、MySQL(version:5.7)//用户业务信息以及管理后台查询消息使用
3、MongoDB(version:4.0.28)//线上消息存储
4、Redis(version:redis_version:7.0.0)//业务信息缓存，以及seq缓存
5、Kafka(version:kafka_2.13-2.8.1,依赖于组件zookeeper(version: 3.4.13-2d71af4dbe22557fda74f9a9b4309b15a7487f03))//消息队列，消息总线解耦
6、Minio(version:minio version RELEASE.2022-05-26T05-48-41Z)//私有化对象存储服务，用于图片、语音、文件等存储在自己的服务器中（注：如果使用三方云服务器存储媒体文件可不搭建）
```

### 2. 部署方式
#### 2.1 方式与优势
**方式**：k8s集群方式部署
**平台**：AWS云或google云的EKS容器服务，ECS弹性计算服务
**优势**：方便后期平行扩展，后期支持亿级用户，千亿级消息

#### 2.2 IM-Server容量评估
**要求**：2台，单机8核32G，100Mb带宽， 40G SSD

**目标**：支持10-15万人

**性能**：
```
同时在线 10万人  
每秒消息数 5000条  
消息延时 平均1-2秒  
消息可达率 100%  
Cpu使用率 90%  
内存占用 28G
```


### 3. 部署预算

| **组件**   | **规格**  | **数量**  | **说明**     | **版本**     |
| -----| ----- |--------|------ | ------ |
| im-server |  8核32G 40G增强版SSD |2|建议2台，不可复用 |2.2.0|
|zookeeper|  4核8G 40G增强版SSD |  3 | 建议3台，可复用 |3.7.1|
| kafka|  8核16G 100G增强版SSD | 3| 以2台8核16G IM Server为例说明topic分区设置，"ws2ms_chat" 8分区，"msg_to_mongo" 8分区，"ms2ps_chat" 10分区| 3.2.0| 
|etcd|  -- | -| 复用zookeeper3台机器 |3.5.0|
|mysql|  -- | -| 复用mongo2台机器。主从两条 |5.7|
| redis |  8核32G 100G增强版SSD | 2| 建议2台以上，可复用。每个内存限制10G， 淘汰策略volatile-ttl |6.2.5 |
|mongo|   8核32G 100G增强版SSD| 2|建议2台以上，可复用。每个cache限制0.5G；多个数据分片副本集，1个mongos副本集，1个config副本集 |5.0|
|MinIO|  8核16G 500G增强版SSD | 2|建议2台以上，可复用|
